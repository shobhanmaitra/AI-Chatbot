<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 90%;
            max-width: 700px;
            height: 88vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 20px;
            font-weight: bold;
        }

        .language-selector {
            padding: 6px 10px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
        }

        .language-selector option {
            background: #667eea;
            color: white;
        }

        .toolbar {
            display: flex;
            gap: 8px;
            padding: 10px 15px;
            background: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            padding: 7px 12px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .export-pdf {
            background: #f44336;
            color: white;
        }

        .export-txt {
            background: #4CAF50;
            color: white;
        }

        .clear-btn {
            background: #FF9800;
            color: white;
        }

        .voice-toggle {
            background: #2196F3;
            color: white;
        }

        .voice-toggle.active {
            background: #0D47A1;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .status {
            text-align: center;
            padding: 7px;
            font-size: 11px;
            color: #666;
            background: #f0f0f0;
            border-bottom: 1px solid #e0e0e0;
        }

        .status.connected {
            color: #4CAF50;
        }

        .status.error {
            color: #f44336;
        }

        .message-counter {
            text-align: center;
            padding: 7px;
            background: #f9f9f9;
            font-size: 11px;
            color: #666;
            border-bottom: 1px solid #e0e0e0;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-items: flex-end;
        }

        .message.bot {
            align-items: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 16px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .timestamp {
            font-size: 10px;
            color: #999;
            margin-top: 3px;
            padding: 0 5px;
        }

        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
        }

        #userInput {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #sendBtn:hover {
            transform: scale(1.05);
        }

        #voiceBtn {
            padding: 10px 15px;
            background: #9C27B0;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #voiceBtn:hover {
            transform: scale(1.05);
        }

        #voiceBtn.listening {
            background: #E91E63;
            animation: pulse 1s infinite;
        }

        .typing-indicator {
            display: none;
            padding: 8px 15px;
            font-style: italic;
            color: #666;
            font-size: 12px;
        }

        .typing-indicator.show {
            display: block;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 18px;
            background: #4CAF50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
            font-size: 13px;
        }

        .notification.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="notification" id="notification"></div>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-title">ü§ñ <span id="headerText">AI Chatbot</span></div>
            <select class="language-selector" id="languageSelector">
                <option value="en">üá¨üáß English</option>
                <option value="hi">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                <option value="es">üá™üá∏ Espa√±ol</option>
                <option value="fr">üá´üá∑ Fran√ßais</option>
                <option value="de">üá©üá™ Deutsch</option>
            </select>
        </div>
        <div class="toolbar">
            <button class="toolbar-btn export-pdf" id="exportPdfBtn">üìÑ <span id="exportPdfText">PDF</span></button>
            <button class="toolbar-btn export-txt" id="exportTxtBtn">üìù <span id="exportTxtText">TXT</span></button>
            <button class="toolbar-btn clear-btn" id="clearBtn">üóëÔ∏è <span id="clearText">Clear</span></button>
            <button class="toolbar-btn voice-toggle" id="voiceToggle">üîä <span id="voiceToggleText">TTS:
                    OFF</span></button>
        </div>
        <div class="status" id="status"><span id="statusText">Connecting...</span></div>
        <div class="message-counter" id="messageCounter">
            <span id="counterText">Messages:</span> <span id="counterValue">0</span>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-content">
                    <span id="welcomeMessage">üëã Hello! I'm your AI assistant. How can I help you today?</span>
                </div>
                <div class="timestamp" id="initialTime"></div>
            </div>
        </div>
        <div class="typing-indicator" id="typingIndicator"><span id="typingText">Bot is typing...</span></div>
        <div class="chat-input-container">
            <button id="voiceBtn" title="Voice Input">üé§</button>
            <input type="text" id="userInput" placeholder="Type your message..." autocomplete="off">
            <button id="sendBtn"><span id="sendText">Send</span></button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const API_URL = 'http://localhost:5000';
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const status = document.getElementById('status');
        const typingIndicator = document.getElementById('typingIndicator');
        const languageSelector = document.getElementById('languageSelector');
        const voiceToggle = document.getElementById('voiceToggle');
        const notification = document.getElementById('notification');

        let messageCount = 0;
        let currentLanguage = 'en';
        let ttsEnabled = false;

        // FEATURE 3: MULTI-LANGUAGE TRANSLATIONS
        const translations = {
            en: { header: "AI Chatbot", exportPdf: "PDF", exportTxt: "TXT", clear: "Clear", ttsOn: "TTS: ON", ttsOff: "TTS: OFF", connecting: "Connecting...", connected: "‚úÖ Connected", disconnected: "‚ùå Disconnected", messagesText: "Messages:", typing: "Bot is typing...", welcome: "üëã Hello! I'm your AI assistant. How can I help you today?", placeholder: "Type your message...", send: "Send", clearConfirm: "Clear chat?", exportedPdf: "Exported as PDF!", exportedTxt: "Exported as TXT!" },
            hi: { header: "‡§è‡§Ü‡§à ‡§ö‡•à‡§ü‡§¨‡•â‡§ü", exportPdf: "PDF", exportTxt: "TXT", clear: "‡§∏‡§æ‡§´‡§º", ttsOn: "TTS: ‡§ö‡§æ‡§≤‡•Ç", ttsOff: "TTS: ‡§¨‡§Ç‡§¶", connecting: "‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...", connected: "‚úÖ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡•á‡§°", disconnected: "‚ùå ‡§°‡§ø‡§∏‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡•á‡§°", messagesText: "‡§∏‡§Ç‡§¶‡•á‡§∂:", typing: "‡§¨‡•â‡§ü ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à...", welcome: "üëã ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç?", placeholder: "‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç...", send: "‡§≠‡•á‡§ú‡•á‡§Ç", clearConfirm: "‡§ö‡•à‡§ü ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç?", exportedPdf: "PDF ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!", exportedTxt: "TXT ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!" },
            es: { header: "Chatbot IA", exportPdf: "PDF", exportTxt: "TXT", clear: "Limpiar", ttsOn: "TTS: ON", ttsOff: "TTS: OFF", connecting: "Conectando...", connected: "‚úÖ Conectado", disconnected: "‚ùå Desconectado", messagesText: "Mensajes:", typing: "Bot escribiendo...", welcome: "üëã ¬°Hola! Soy tu asistente. ¬øC√≥mo puedo ayudarte?", placeholder: "Escribe...", send: "Enviar", clearConfirm: "¬øBorrar chat?", exportedPdf: "¬°Exportado como PDF!", exportedTxt: "¬°Exportado como TXT!" },
            fr: { header: "Chatbot IA", exportPdf: "PDF", exportTxt: "TXT", clear: "Effacer", ttsOn: "TTS: ON", ttsOff: "TTS: OFF", connecting: "Connexion...", connected: "‚úÖ Connect√©", disconnected: "‚ùå D√©connect√©", messagesText: "Messages:", typing: "Bot √©crit...", welcome: "üëã Bonjour! Je suis votre assistant. Comment puis-je vous aider?", placeholder: "Tapez...", send: "Envoyer", clearConfirm: "Effacer le chat?", exportedPdf: "Export√© en PDF!", exportedTxt: "Export√© en TXT!" },
            de: { header: "KI-Chatbot", exportPdf: "PDF", exportTxt: "TXT", clear: "L√∂schen", ttsOn: "TTS: EIN", ttsOff: "TTS: AUS", connecting: "Verbindung...", connected: "‚úÖ Verbunden", disconnected: "‚ùå Getrennt", messagesText: "Nachrichten:", typing: "Bot tippt...", welcome: "üëã Hallo! Ich bin Ihr Assistent. Wie kann ich helfen?", placeholder: "Tippen...", send: "Senden", clearConfirm: "Chat l√∂schen?", exportedPdf: "Als PDF exportiert!", exportedTxt: "Als TXT exportiert!" }
        };

        function updateLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            document.getElementById('headerText').textContent = t.header;
            document.getElementById('exportPdfText').textContent = t.exportPdf;
            document.getElementById('exportTxtText').textContent = t.exportTxt;
            document.getElementById('clearText').textContent = t.clear;
            document.getElementById('voiceToggleText').textContent = ttsEnabled ? t.ttsOn : t.ttsOff;
            document.getElementById('counterText').textContent = t.messagesText;
            document.getElementById('typingText').textContent = t.typing;
            document.getElementById('sendText').textContent = t.send;
            userInput.placeholder = t.placeholder;
            if (status.classList.contains('connected')) document.getElementById('statusText').textContent = t.connected;
            else if (status.classList.contains('error')) document.getElementById('statusText').textContent = t.disconnected;
            else document.getElementById('statusText').textContent = t.connecting;
        }

        languageSelector.addEventListener('change', (e) => {
            updateLanguage(e.target.value);
            showNotification('Language: ' + e.target.options[e.target.selectedIndex].text);
        });

        // FEATURE 2: VOICE INPUT (Speech Recognition)
        let recognition = null;
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.onstart = () => { voiceBtn.classList.add('listening'); voiceBtn.textContent = 'üî¥'; };
            recognition.onend = () => { voiceBtn.classList.remove('listening'); voiceBtn.textContent = 'üé§'; };
            recognition.onresult = (e) => { userInput.value = e.results[0][0].transcript; sendMessage(); };
            recognition.onerror = () => { voiceBtn.classList.remove('listening'); voiceBtn.textContent = 'üé§'; };
        }

        voiceBtn.addEventListener('click', () => {
            if (recognition) {
                if (voiceBtn.classList.contains('listening')) recognition.stop();
                else {
                    recognition.lang = currentLanguage === 'hi' ? 'hi-IN' : currentLanguage === 'es' ? 'es-ES' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'de' ? 'de-DE' : 'en-US';
                    recognition.start();
                }
            } else alert('Voice not supported. Use Chrome/Edge/Safari.');
        });

        // FEATURE 2: TEXT-TO-SPEECH
        function speakText(text) {
            if (!ttsEnabled || !('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLanguage === 'hi' ? 'hi-IN' : currentLanguage === 'es' ? 'es-ES' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'de' ? 'de-DE' : 'en-US';
            window.speechSynthesis.speak(utterance);
        }

        voiceToggle.addEventListener('click', () => {
            ttsEnabled = !ttsEnabled;
            voiceToggle.classList.toggle('active');
            document.getElementById('voiceToggleText').textContent = translations[currentLanguage][ttsEnabled ? 'ttsOn' : 'ttsOff'];
            showNotification('TTS: ' + (ttsEnabled ? 'ON' : 'OFF'));
        });

        // FEATURE 5: EXPORT TO PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const msgs = Array.from(chatMessages.querySelectorAll('.message')).map(m => ({
                sender: m.classList.contains('user') ? 'User' : 'Bot',
                content: m.querySelector('.message-content').textContent,
                time: m.querySelector('.timestamp').textContent
            }));
            doc.setFontSize(16); doc.text('AI Chatbot Conversation', 20, 20);
            doc.setFontSize(10); doc.text(`Date: ${new Date().toLocaleString()}`, 20, 30);
            doc.text(`Messages: ${messageCount}`, 20, 35);
            let y = 45;
            doc.setFontSize(11);
            msgs.forEach(msg => {
                if (y > 270) { doc.addPage(); y = 20; }
                doc.setFont(undefined, 'bold');
                doc.text(`${msg.sender} [${msg.time}]:`, 20, y); y += 5;
                doc.setFont(undefined, 'normal');
                const lines = doc.splitTextToSize(msg.content, 170);
                doc.text(lines, 20, y);
                y += lines.length * 5 + 5;
            });
            doc.save(`chat-${Date.now()}.pdf`);
            showNotification(translations[currentLanguage].exportedPdf);
        }

        // FEATURE 5: EXPORT TO TXT
        function exportToTXT() {
            let txt = `AI Chatbot Conversation\n${'='.repeat(30)}\nDate: ${new Date().toLocaleString()}\nMessages: ${messageCount}\n${'='.repeat(30)}\n\n`;
            chatMessages.querySelectorAll('.message').forEach(m => {
                const sender = m.classList.contains('user') ? 'User' : 'Bot';
                const content = m.querySelector('.message-content').textContent;
                const time = m.querySelector('.timestamp').textContent;
                txt += `[${time}] ${sender}: ${content}\n\n`;
            });
            const blob = new Blob([txt], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `chat-${Date.now()}.txt`;
            a.click();
            showNotification(translations[currentLanguage].exportedTxt);
        }

        document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
        document.getElementById('exportTxtBtn').addEventListener('click', exportToTXT);

        function showNotification(msg) {
            notification.textContent = msg;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 2500);
        }

        function getCurrentTime() {
            const now = new Date();
            let h = now.getHours(), m = now.getMinutes();
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            m = m < 10 ? '0' + m : m;
            return `${h}:${m} ${ampm}`;
        }

        document.getElementById('initialTime').textContent = getCurrentTime();

        function updateCounter() {
            document.getElementById('counterValue').textContent = messageCount;
        }

        async function testConnection() {
            try {
                await fetch(`${API_URL}/test`);
                document.getElementById('statusText').textContent = translations[currentLanguage].connected;
                status.className = 'status connected';
            } catch {
                document.getElementById('statusText').textContent = translations[currentLanguage].disconnected;
                status.className = 'status error';
            }
        }

        function addMessage(content, isUser, animate = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            const timestampDiv = document.createElement('div');
            timestampDiv.className = 'timestamp';
            timestampDiv.textContent = getCurrentTime();
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(timestampDiv);
            chatMessages.appendChild(messageDiv);

            if (animate && !isUser) {
                let i = 0;
                contentDiv.textContent = '';
                const interval = setInterval(() => {
                    if (i < content.length) {
                        contentDiv.textContent += content.charAt(i++);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else {
                        clearInterval(interval);
                        speakText(content);
                        saveChat();
                    }
                }, 30);
            } else {
                contentDiv.textContent = content;
                saveChat();
            }

            chatMessages.scrollTop = chatMessages.scrollHeight;
            if (isUser) { messageCount++; updateCounter(); }
        }

        async function sendMessage() {
            const msg = userInput.value.trim();
            if (!msg) return;
            addMessage(msg, true);
            userInput.value = '';
            typingIndicator.classList.add('show');

            try {
                const res = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg, language: currentLanguage })
                });
                const data = await res.json();
                typingIndicator.classList.remove('show');
                if (data.response) addMessage(data.response, false, true);
                else if (data.error) addMessage('Error: ' + data.error, false, true);
            } catch {
                typingIndicator.classList.remove('show');
                addMessage('‚ùå Server error!', false, true);
            }
        }

        function saveChat() {
            const msgs = Array.from(chatMessages.querySelectorAll('.message')).map(m => ({
                content: m.querySelector('.message-content').textContent,
                timestamp: m.querySelector('.timestamp').textContent,
                isUser: m.classList.contains('user')
            }));
            localStorage.setItem('chatHistory', JSON.stringify(msgs));
            localStorage.setItem('messageCount', messageCount);
        }

        function loadChat() {
            const saved = localStorage.getItem('chatHistory');
            const count = localStorage.getItem('messageCount');
            if (saved) {
                chatMessages.innerHTML = '';
                JSON.parse(saved).forEach(m => {
                    const div = document.createElement('div');
                    div.className = `message ${m.isUser ? 'user' : 'bot'}`;
                    div.innerHTML = `<div class="message-content">${m.content}</div><div class="timestamp">${m.timestamp}</div>`;
                    chatMessages.appendChild(div);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            if (count) { messageCount = parseInt(count); updateCounter(); }
        }

        function clearChat() {
            if (confirm(translations[currentLanguage].clearConfirm)) {
                chatMessages.innerHTML = `<div class="message bot"><div class="message-content"><span id="welcomeMessage">${translations[currentLanguage].welcome}</span></div><div class="timestamp">${getCurrentTime()}</div></div>`;
                messageCount = 0;
                updateCounter();
                localStorage.removeItem('chatHistory');
                localStorage.removeItem('messageCount');
                showNotification('Chat cleared!');
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
        document.getElementById('clearBtn').addEventListener('click', clearChat);

        loadChat();
        testConnection();
    </script>
</body>

</html>